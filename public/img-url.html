<!-- img-url.html -->

<!DOCTYPE html>
<html>

<head>
    <title>Image URL Viewer</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            color: #333;
        }
    </style>
</head>

<body>
    <!-- Theme switcher button -->
    <button id="theme-switcher">Switch Theme</button>

    <!-- Container for the theme switcher -->
    <div id="theme-switcher-container">
        <input type="radio" id="light-theme" name="theme" value="light" checked>
        <label for="light-theme">Light</label>
        <input type="radio" id="dark-theme" name="theme" value="dark">
        <label for="dark-theme">Dark</label>
    </div>
    <a href="index.html">
    <button class="back-button">Back</button></a>
    <div class="container">
        <h1>Image Details</h1>
        <div class="input-container">
            <input class="input" id="url-input" type="text" placeholder="Enter image URL">
            <button class="paste-button" id="paste-button">Paste</button>
        </div>
        <button class="button" id="load-button">Load Image</button>
        <br>
        <br>
        <img class="image" id="image" src="">
        <div class="image-details" id="image-details"></div>
    </div>
    <script>
        const urlInput = document.getElementById('url-input');
        const loadButton = document.getElementById('load-button');
        const image = document.getElementById('image');
        const imageDetails = document.getElementById('image-details');
        
        function setDetailsFrom(img, url) {
            const w = img.naturalWidth || img.width;
            const h = img.naturalHeight || img.height;
            if (!w || !h) return;
            const details = `
                <h3>Image Details:</h3>
                <p><strong>Width:</strong> ${w}</p>
                <p><strong>Height:</strong> ${h}</p>
                <p><strong>Aspect Ratio:</strong> ${(w / h).toFixed(4)}</p>
                <p><strong>Orientation:</strong> ${w > h ? 'Landscape' : 'Portrait'}</p>
                <p><strong>URL:</strong> ${url}</p>
                <p><strong>Pixel Count:</strong> ${w * h} pixels</p>
                <p><strong>Resolution:</strong> ${w} x ${h} pixels</p>
            `;
            imageDetails.innerHTML = details;
        }

        async function loadImageWithFallback(rawUrl) {
            imageDetails.textContent = '';
            image.removeAttribute('src');
            image.setAttribute('alt', '');
            image.crossOrigin = 'anonymous';

            const tryLoad = (src) => new Promise((resolve, reject) => {
                image.onload = () => resolve({ ok: true, src });
                image.onerror = () => reject(new Error('load-failed'));
                // attach handlers before setting src
                image.src = src;
            });

            // First attempt: direct URL
            try {
                const result = await tryLoad(rawUrl);
                setDetailsFrom(image, rawUrl);
                return result;
            } catch (_) {
                // ignore; fallback below
            }

            // Second attempt: proxy through our backend to avoid CORS/hotlink issues
            try {
                const proxied = `/proxy?url=${encodeURIComponent(rawUrl)}`;
                const result = await tryLoad(proxied);
                setDetailsFrom(image, rawUrl);
                return result;
            } catch (err) {
                imageDetails.innerHTML = '<p style="color:red">Failed to load image from the provided URL. Please verify the URL or try downloading and using Upload Image instead.</p>';
                throw err;
            }
        }

        const pasteButton = document.getElementById('paste-button');

        pasteButton.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('url-input').value = text;
            } catch (error) {
                console.error('Failed to read clipboard contents:', error);
            }
        });
        loadButton.addEventListener('click', async () => {
            const url = urlInput.value.trim();
            if (!url) return;
            try {
                await loadImageWithFallback(url);
            } catch (e) {
                // already handled
            }
        });
    </script>
    <script src="script.js"></script>

</body>

</html>